<script>

$(document).ready(function() {
$('.table').dataTable({
	paging: false
});
})

</script>

<div class="panel panel-primary">
	<div class="panel-heading">
		<h3 class="panel-title">Record Attendance For <%= params[:event] %></h3>
	</div>
	<div class="panel-body">
		<div class="container">
			</div>
			<%= form_for(@attendance) do |f| %>
			<div id="selection">
				<%= f.label "Absent Users" %> <i> ~Only select absent/tardy users, leave blank if present.</i>
				<table class="table table-striped table-bordered">
					<thead>
						<tr>
							<th> Name </th>
							<th> Event </th>
							<th> Absent </th>
							<% if Event.find_by_event_name(params[:event]).max_tardies != nil %>
							<th> Tardy </th>
							<% end %>

						</tr>
					</thead>
					<% if Group.find(params[:group_id]).grouptype != "Alternate "+params[:event]+" Attendance"%>
					<tbody>
						<% users_in_group_excused_excluded(params[:group_id], params[:event]).each do |user| %>
						<tr>
							<td><%= user.fname + " "+user.lname %></td>
							<td><%= params[:event]%></td>
							<td><%= check_box_tag 'project[absent_user_ids][]', user.id, false %></td>
							<% if Event.find_by_event_name(params[:event]).max_tardies != nil %>
							<td><%= check_box_tag 'project[tardy_user_ids][]', user.id, false %></td>
							<% end %>
						</tr>
						<%end%>
					</tbody>
					<%else%>
					<tbody>
						<% users_in_group_unfiltered(params[:group_id]).each do |user| %>
						<tr>
							<td><%= user.fname + " "+user.lname %></td>
							<td><%= params[:event]%></td>
							<td><%= check_box_tag 'project[absent_user_ids][]', user.id, false %></td>
							<% if Event.find_by_event_name(params[:event]).max_tardies != nil %>
							<td><%= check_box_tag 'project[tardy_user_ids][]', user.id, false %></td>
							<% end %>
						</tr>
						<%end%>
					</tbody>
					<%end%>
				</table>
			</div>
			<%= f.hidden_field :groups_id, :value=>params[:group_id]%>
			<%= f.hidden_field :event, :value=>params[:event]%>

			<div class="actions">
				<%= f.submit 'Submit', data: {confirm: 'Please review your selections hence your changes are permanent. Press cancel if you wish to make a change, otherwise press OK', toggle: "modal", target: '#myModal'  }, :class=>'btn btn-primary btn-block' %>
				<br>
			</div>
			<%end%>
			<br>
			<h3>Users Marked absent today (<%=Time.now.strftime("%D")%>)</h3>
			<i>~Use this to make sure you have marked everyone correctly</i>
			<table class="table table-striped table-bordered">
				<thead>
					<th>Name</th>
					<th>Absent</th>
					<th>Tardy</th>
					<th>Event</th>
					<th>Date</th>
				</thead>
				<tbody>
					<% Attendance.where(:date_recorded => Time.now.strftime("%D")).each do |record| %>
					<tr>
						<td><%= User.find(record.user_id).fname + " " + User.find(record.user_id).lname%></td>
						<td><%= record.absent %></td>
						<td><%= record.tardy %></td>
						<td><%= record.event %></td>
						<td><%= record.date_recorded %></td>
					</tr>
					<%end%>
				</tbody>
			</table>

		</div>
	</div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="myModal" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title" id="myModalLabel">Updating records and notifying users... Please wait.</h4>
			</div>
			<div class="modal-body">
				<div class="progress">
					<div class="progress-bar progress-bar-striped active"  role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- JQuery code to  show the form -->
<script>
	$(document).ready(function() {
		$('select').selectpicker();
	});

	$("input:checkbox").on('click', function() {
		var $box = $(this);
		if ($box.is(":checked")) {
			var group = "input:checkbox[value='" + $box.attr("value") + "']";
			$(group).prop("checked", false);
			$box.prop("checked", true);
		} else {
			$box.prop("checked", false);
		}
	});

</script>
