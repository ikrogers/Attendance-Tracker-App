<script>

$(document).ready(function() {
$('.table').dataTable();
})

</script>

<div class="panel panel-primary">
	<div class="panel-heading">
		<h3 class="panel-title">Attendance Records</h3>
	</div>
	<div class="panel-body">
		<% @currentgroup = Group.find_by_id(params[:attgroup_id]) rescue nil %>
		<% if @currentgroup != nil %>
		<% @currentuserattendance = Attendance.where(groups_id: @currentgroup.id) rescue nil %>
		<h1>Absence Records For Group: <%= @currentgroup.name %></h1>

		<table class="table table-striped table-bordered" id = "maint">
			<thead>
				<tr>
					<th> Absent user </th>
					<th> Tardy/Absent</th>
					<th> Event </th>
					<th> Recorded Date </th>
					<th> Tracker </th>
					<th> Remove Record </th>
				</tr>
			</thead>

			<tbody>
				<% @currentuserattendance.each do |attendance| %>

				<tr>
					<td><%= (User.find_by_id(attendance.user_id).fname+" "+User.find_by_id(attendance.user_id).lname) %></td>
					<% if attendance.absent == true && attendance.absence_tardy == nil %>
					<td>Absent</td>
					<% elsif attendance.tardy == true %>
					<td>Tardy</td>
					<% elsif attendance.absence_tardy == true %>
					<td>Tardy limit absence</td>
					<% end %>
					<td><%= attendance.event %></td>
					<td><%= Date.strptime(attendance.date_recorded,"%m/%d/%y").to_date.to_formatted_s("%M/%d/%Y").to_date.to_formatted_s(:long)%></td>
					<%if attendance.tracker_id==nil%>
					<td>Tracker account was destroyed</td>
					<%else%>
					<td><%= User.find_by_id(attendance.tracker_id).email %></td>
					<%end%>
					<td><%= link_to 'Destroy', attendance, method: :delete, data: { confirm: 'Are you sure?' }, :class=>'btn btn-danger' %></td>

				</tr>
				<% end %>
			</tbody>
		</table>
		<%= link_to 'Insert Attendance Record', insert_attendance_path(Group.find_by_id(params[:attgroup_id]).id), :class => 'btn btn-primary' %>

		<% else %>
		<% @currentuserattendance = Attendance.where(groups_id: nil) rescue nil %>
		<h1>Absence Records For Group: Deleted!</h1>
		<table class="table table-striped table-bordered">
			<thead>
				<tr>
					<th> Absent user </th>
					<th> Event </th>
					<th> Recorded Date </th>
					<th> Tracker </th>
					<th> Assign Group</th>
					<th> Remove Record </th>
				</tr>
			</thead>

			<tbody>
				<% @currentuserattendance.each do |attendance| %>
				<tr>
					<td><%= User.find_by_id(attendance.user_id).email %></td>
					<td><%= attendance.event %></td>
					<td><%= Date.strptime(attendance.date_recorded,"%m/%d/%y").to_date.to_formatted_s("%M/%d/%Y").to_date.to_formatted_s(:long) %></td>
					<%if attendance.tracker_id==nil%>
					<td>Tracker account was destroyed</td>
					<%else%>
					<td><%= User.find_by_id(attendance.tracker_id).email %></td>
					<%end%>
					<td><%= link_to 'Update', update_attendance_form_path(attendance.id), :class => 'btn btn-warning'%></td>
					<td><%= link_to 'Destroy', attendance, method: :delete, data: { confirm: 'Are you sure?', toggle: "modal", target: '#myModal'}, :class=>'btn btn-danger' %></td>
				</tr>
				<div class="modal fade" id="myModal" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<h4 class="modal-title" id="myModalLabel">Updating records and notifying users... Please wait.</h4>
							</div>
							<div class="modal-body">
								<div class="progress">
									<div class="progress-bar progress-bar-striped active"  role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<% end %>
			</tbody>
		</table>
		<% end %>
		<br>
	</div>
</div>
<!-- Loading Modal -->
